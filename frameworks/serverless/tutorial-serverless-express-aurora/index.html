<!DOCTYPE html>
<html lang="ko-KR">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Tutorial: serverless-express-aurora | 쿡앱스 기술 블로그</title>
    <meta name="description" content="sandbox 팀에서 운영하는 기술 블로그입니다.">
    <link rel="icon" href="/icon.png">
  <link rel="manifest" href="/manifest.webmanifest">
  <meta name="naver-site-verification" content="9f6fd9374b76e620a5d27ecde3ad0ce5ff285294">
  <meta name="google-site-verification" content="mE3gNyo5dv_Uw5cyV0Z-aAuOyYphLiu5ejyVAWk-ujE">
    
    <link rel="preload" href="/assets/css/0.styles.d12c699e.css" as="style"><link rel="preload" href="/assets/js/app.bdc570e9.js" as="script"><link rel="preload" href="/assets/js/2.e34b6f30.js" as="script"><link rel="preload" href="/assets/js/3.e459d297.js" as="script"><link rel="prefetch" href="/assets/js/10.8c6206d8.js"><link rel="prefetch" href="/assets/js/11.aa695e12.js"><link rel="prefetch" href="/assets/js/12.e541e2a4.js"><link rel="prefetch" href="/assets/js/13.9c1acf6e.js"><link rel="prefetch" href="/assets/js/14.3f66bced.js"><link rel="prefetch" href="/assets/js/15.725a10e7.js"><link rel="prefetch" href="/assets/js/16.f6336825.js"><link rel="prefetch" href="/assets/js/17.2f5b8a47.js"><link rel="prefetch" href="/assets/js/18.dac61c6c.js"><link rel="prefetch" href="/assets/js/19.563cbe5c.js"><link rel="prefetch" href="/assets/js/20.e3ff4309.js"><link rel="prefetch" href="/assets/js/21.6ba84245.js"><link rel="prefetch" href="/assets/js/22.b287b7eb.js"><link rel="prefetch" href="/assets/js/23.17ecc02d.js"><link rel="prefetch" href="/assets/js/24.7681d1f1.js"><link rel="prefetch" href="/assets/js/25.b1827863.js"><link rel="prefetch" href="/assets/js/26.b9cc6cc5.js"><link rel="prefetch" href="/assets/js/27.5d6b0b05.js"><link rel="prefetch" href="/assets/js/28.52fa5ebf.js"><link rel="prefetch" href="/assets/js/29.9793156c.js"><link rel="prefetch" href="/assets/js/30.b19e4f16.js"><link rel="prefetch" href="/assets/js/4.81b4116f.js"><link rel="prefetch" href="/assets/js/5.33054d91.js"><link rel="prefetch" href="/assets/js/6.ed5ccd4c.js"><link rel="prefetch" href="/assets/js/7.db887615.js"><link rel="prefetch" href="/assets/js/8.2685572d.js"><link rel="prefetch" href="/assets/js/9.093f07b6.js">
    <link rel="stylesheet" href="/assets/css/0.styles.d12c699e.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">쿡앱스 기술 블로그</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/guide/" class="nav-link">Guide</a></div><div class="nav-item"><a href="/frameworks/" class="nav-link router-link-active">Frameworks</a></div><div class="nav-item"><a href="/cook-dev/" class="nav-link">Cook Dev</a></div><div class="nav-item"><a href="/cheat-sheet/" class="nav-link">Cheat Sheet</a></div><div class="nav-item"><a href="https://www.cookapps.com/jobs" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Jobs
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/cookpi/blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/guide/" class="nav-link">Guide</a></div><div class="nav-item"><a href="/frameworks/" class="nav-link router-link-active">Frameworks</a></div><div class="nav-item"><a href="/cook-dev/" class="nav-link">Cook Dev</a></div><div class="nav-item"><a href="/cheat-sheet/" class="nav-link">Cheat Sheet</a></div><div class="nav-item"><a href="https://www.cookapps.com/jobs" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Jobs
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/cookpi/blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><a href="/frameworks/" class="sidebar-link">Frameworks</a></li><li><div class="sidebar-group"><p class="sidebar-heading open"><span>Serverless</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/frameworks/serverless/" class="sidebar-link">Overview</a></li><li><a href="/frameworks/serverless/rest-api/" class="sidebar-link">REST API</a></li><li><a href="/frameworks/serverless/tutorial-serverless-express-aurora/" class="active sidebar-link">Tutorial: serverless-express-aurora</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/frameworks/serverless/tutorial-serverless-express-aurora/#소개" class="sidebar-link">소개</a></li><li class="sidebar-sub-header"><a href="/frameworks/serverless/tutorial-serverless-express-aurora/#step-0-준비사항" class="sidebar-link">Step 0 : 준비사항</a></li><li class="sidebar-sub-header"><a href="/frameworks/serverless/tutorial-serverless-express-aurora/#step-1-package-설정" class="sidebar-link">Step 1 : Package 설정</a></li><li class="sidebar-sub-header"><a href="/frameworks/serverless/tutorial-serverless-express-aurora/#step-2-serverless-yml-생성-및-설정" class="sidebar-link">Step 2 : serverless.yml 생성 및 설정</a></li><li class="sidebar-sub-header"><a href="/frameworks/serverless/tutorial-serverless-express-aurora/#step-3-express-기본-설정" class="sidebar-link">Step 3 : Express 기본 설정</a></li><li class="sidebar-sub-header"><a href="/frameworks/serverless/tutorial-serverless-express-aurora/#step-4-rest-prototype" class="sidebar-link">Step 4 : REST Prototype</a></li><li class="sidebar-sub-header"><a href="/frameworks/serverless/tutorial-serverless-express-aurora/#step-5-error-handling" class="sidebar-link">Step 5 : Error Handling</a></li><li class="sidebar-sub-header"><a href="/frameworks/serverless/tutorial-serverless-express-aurora/#step-6-database-setup" class="sidebar-link">Step 6 : Database Setup</a></li><li class="sidebar-sub-header"><a href="/frameworks/serverless/tutorial-serverless-express-aurora/#step-7-user-crud" class="sidebar-link">Step 7 : User CRUD</a></li><li class="sidebar-sub-header"><a href="/frameworks/serverless/tutorial-serverless-express-aurora/#step-8-extract-filter-sort-pagination" class="sidebar-link">Step 8 : Extract, Filter, Sort, Pagination</a></li><li class="sidebar-sub-header"><a href="/frameworks/serverless/tutorial-serverless-express-aurora/#step-9-nested-route" class="sidebar-link">Step 9 : Nested Route</a></li><li class="sidebar-sub-header"><a href="/frameworks/serverless/tutorial-serverless-express-aurora/#step-10-deploy" class="sidebar-link">Step 10 : Deploy</a></li><li class="sidebar-sub-header"><a href="/frameworks/serverless/tutorial-serverless-express-aurora/#bonus-step-11-jwt-token을-이용한-간단한-인증처리" class="sidebar-link">(Bonus) Step 11 : JWT Token을 이용한 간단한 인증처리</a></li><li class="sidebar-sub-header"><a href="/frameworks/serverless/tutorial-serverless-express-aurora/#bonus-step-12-cron" class="sidebar-link">(Bonus) Step 12 : Cron</a></li><li class="sidebar-sub-header"><a href="/frameworks/serverless/tutorial-serverless-express-aurora/#bonus-step-13-breakpoint" class="sidebar-link">(Bonus) Step 13 : BreakPoint</a></li></ul></li></ul></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Firebase</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>AWS</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>GCP</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Unity</span> <span class="arrow right"></span></p> <!----></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="tutorial-serverless-express-aurora"><a href="#tutorial-serverless-express-aurora" aria-hidden="true" class="header-anchor">#</a> Tutorial: serverless-express-aurora <span class="badge tip top" data-v-099ab69c>mhma</span></h1> <p>https://github.com/cookpi/tutorial-serverless-express-aurora</p> <h2 id="소개"><a href="#소개" aria-hidden="true" class="header-anchor">#</a> 소개</h2> <ul><li>본 튜토리얼은 Serverless Framework + Express + Aurora 를 사용하여 간단한 REST API를 제작하고 배포하는 내용에 대해 다룹니다.</li> <li>튜토리얼 특성 상 빠른 학습을 위해 Babel, WebPack은 포함하지 않았기 때문에 Polyfill이 필요한 ES6 문법은 사용하지 않습니다.</li></ul> <h2 id="step-0-준비사항"><a href="#step-0-준비사항" aria-hidden="true" class="header-anchor">#</a> Step 0 : 준비사항</h2> <ul><li><a href="https://aws.amazon.com/ko/" target="_blank" rel="noopener noreferrer">AWS 계정<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 생성</li> <li><a href="https://www.getpostman.com/" target="_blank" rel="noopener noreferrer">Postman<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 설치</li> <li>node 설치 (&gt;= v8.0)</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ brew <span class="token function">install</span> node
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>프로젝트 폴더 생성</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ <span class="token function">mkdir</span> serverless-tutorial
$ <span class="token function">cd</span> serverless-tutorial/
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="step-1-package-설정"><a href="#step-1-package-설정" aria-hidden="true" class="header-anchor">#</a> Step 1 : Package 설정</h2> <h3 id="gitignore-생성"><a href="#gitignore-생성" aria-hidden="true" class="header-anchor">#</a> .gitignore 생성</h3> <p>root 디렉토리에 .gitignore 파일을 생성한 후 다음과 같이 작성합니다.</p> <div class="language- line-numbers-mode"><pre class="language-text"><code># .gitignore
node_modules/
yarn-error.log
.serverless
secret.js
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="package-초기화-및-설치"><a href="#package-초기화-및-설치" aria-hidden="true" class="header-anchor">#</a> Package 초기화 및 설치</h3> <p>터미널을 열고 yarn init 명령어를 통해 기본 package.json을 생성한 후 다음 패키지들을 설치해줍니다.<br>
serverless-offline-* 플러그인은 테스트 용도이므로 DEV로 설치합니다.</p> <ul><li><a href="https://serverless.com/framework/docs/providers/aws/guide/intro/" target="_blank" rel="noopener noreferrer">serverless<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> <ul><li>AWS Lambda functions를 손쉽게 개발 및 배포할 수 있게 해주는 모듈</li></ul></li> <li><a href="https://github.com/awslabs/aws-serverless-express" target="_blank" rel="noopener noreferrer">aws-serverless-express<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> <ul><li>Serverless 환경에서 Express 기반 어플리케이션 및 REST APIs 빌드를 하기 위한 모듈</li></ul></li> <li><a href="https://www.npmjs.com/package/serverless-mysql" target="_blank" rel="noopener noreferrer">serverless-mysql<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> <ul><li>Serverless 환경에서 MySQL connections를 관리해주는 Serverless 플러그인</li></ul></li> <li><a href="https://www.npmjs.com/package/serverless-offline" target="_blank" rel="noopener noreferrer">serverless-offline<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> <ul><li>Serverless 어플리케이션을 로컬 환경에서 동작하게 하는 Serveless 플러그인</li></ul></li> <li><a href="https://www.npmjs.com/package/serverless-offline-scheduler" target="_blank" rel="noopener noreferrer">serverless-offline-scheduler<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> <ul><li>Scheduled 람다를 로컬 환경에서 동작 하게 하는 Serverless 플러그인</li></ul></li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ <span class="token function">yarn</span> init -y <span class="token comment"># or npm init -y</span>
$ <span class="token function">yarn</span> <span class="token function">add</span> express aws-serverless-express serverless-mysql <span class="token comment"># or npm i -g &lt;package_name&gt;</span>
$ <span class="token function">yarn</span> <span class="token function">add</span> serverless serverless-offline serverless-offline-scheduler -D <span class="token comment"># or npm i -g &lt;package_name&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="package-scripts-작성"><a href="#package-scripts-작성" aria-hidden="true" class="header-anchor">#</a> Package Scripts 작성</h3> <p>package.json을 열고 예시에 있는 scripts를 추가합니다. 다음 스크립트는 어플리케이션 실행을 더 편하게 만들어 줍니다.<br>
예로 다음 스크립트는 로컬 테스트를 위해 매 번 &quot;serverless offline start&quot;를 타이핑 할 필요 없이 &quot;yarn dev&quot;만으로 실행할 수 있게 해줍니다.</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code># package.json
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;dev&quot;</span><span class="token operator">:</span> <span class="token string">&quot;serverless offline start&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;deploy&quot;</span><span class="token operator">:</span> <span class="token string">&quot;serverless deploy&quot;</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>최종적으로 완성된 형태는 다음과 같습니다.</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code># package.json - Full Example
<span class="token punctuation">{</span>
  <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;tutorial-serverless-express-aurora&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1.0.0&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;main&quot;</span><span class="token operator">:</span> <span class="token string">&quot;index.js&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;repository&quot;</span><span class="token operator">:</span> <span class="token string">&quot;https://github.com/cookappsdev/tutorial-serverless-express-aurora.git&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;author&quot;</span><span class="token operator">:</span> <span class="token string">&quot;mani&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;license&quot;</span><span class="token operator">:</span> <span class="token string">&quot;MIT&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;dev&quot;</span><span class="token operator">:</span> <span class="token string">&quot;serverless offline start&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;deploy&quot;</span><span class="token operator">:</span> <span class="token string">&quot;serverless deploy&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;debug&quot;</span><span class="token operator">:</span> <span class="token string">&quot;export SLS_DEBUG=* &amp;&amp; node --debug ./node_modules/serverless/bin/serverless offline -s dev&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;dependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;aws-serverless-express&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^3.3.5&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;express&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^4.16.4&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;serverless-mysql&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^1.2.1&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;devDependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;serverless&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^1.38.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;serverless-offline&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^4.9.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;serverless-offline-scheduler&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^0.3.7&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><h2 id="step-2-serverless-yml-생성-및-설정"><a href="#step-2-serverless-yml-생성-및-설정" aria-hidden="true" class="header-anchor">#</a> Step 2 : serverless.yml 생성 및 설정</h2> <p>serverless.yml 파일은 serverless를 배포하기위한 설정들로써 배포할 지역이나 Function 등을 지정하는 역할을 합니다.
모든 Properties에 대한 레퍼런스는 <a href="https://serverless.com/framework/docs/providers/aws/guide/serverless.yml/" target="_blank" rel="noopener noreferrer">Serverless.yml Reference<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>를 참고해주세요.</p> <p>Serverless Framework Config 설정을 위해 루트 디렉토리에 serverless.yml 파일을 생성하고 다음 스크립트를 추가합니다.</p> <div class="language-yml line-numbers-mode"><pre class="language-text"><code>service: serverless-tutorial
provider:
  name: aws
  runtime: nodejs8.10
  stage: prod             # optional, default: dev
  region: ap-northeast-2  # optional, default: us-east-1
  memorySize: 128         # optional, in MB, default: 1024
  timeout: 30             # optional, in seconds, default: 6
  versionFunctions: false # optional, default: true
functions:
  api:
    name: ${self:service}-${self:provider.stage}
    handler: api/index.handler  # ${DIR}/${FILE}.${MODULE}
    events:
      - http: ANY /api/{proxy+}
plugins:
  - serverless-offline
  - serverless-offline-scheduler
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h2 id="step-3-express-기본-설정"><a href="#step-3-express-기본-설정" aria-hidden="true" class="header-anchor">#</a> Step 3 : Express 기본 설정</h2> <p>본 단계에선 Express를 설정하여 간단한 HTTP 테스트를 실행해봅니다.</p> <p>다음과 같이 api 폴더 및 index.js파일을 생성합니다.</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>├── api             <span class="token comment"># create dir</span>
│   └── index.js    <span class="token comment"># create file</span>
├── package.json
├── serverless.yml
└── yarn.lock
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>index.js 파일에 다음과 같이 작성합니다.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// api/index.js</span>
<span class="token keyword">const</span> awsServerlessExpress <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'aws-serverless-express'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// body 파싱 기능을 추가합니다. req.body 접근시 필요합니다.</span>

app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/api/ping'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> ping<span class="token punctuation">:</span> <span class="token string">'pong~'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> server <span class="token operator">=</span> awsServerlessExpress<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span>app<span class="token punctuation">)</span>

exports<span class="token punctuation">.</span><span class="token function-variable function">handler</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">event<span class="token punctuation">,</span> context</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> awsServerlessExpress<span class="token punctuation">.</span><span class="token function">proxy</span><span class="token punctuation">(</span>server<span class="token punctuation">,</span> event<span class="token punctuation">,</span> context<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>aws-serverless-express 모듈은 aws의 부가적인 기능/정보에 대한 편의를 제공하며, 기본 Express 모듈을 사용하여도 무방합니다.</p> <p>다음 명령어로 로컬 환경에서 테스트 서버를 구동합니다.</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ <span class="token function">yarn</span> dev
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>실행 결과로 나온 주소로 GET method로 등록된 ping API를 호출해봅니다.<br>
예제의 경우 http://localhost:3000/api/ping 으로 호출할 수 있습니다. 다음 실행 결과를 Postman으로 확인해보세요.</p> <h4 id="실행-결과"><a href="#실행-결과" aria-hidden="true" class="header-anchor">#</a> 실행 결과</h4> <p><img src="/assets/img/step3-01.d3d40019.png" alt="step3-01"></p> <h2 id="step-4-rest-prototype"><a href="#step-4-rest-prototype" aria-hidden="true" class="header-anchor">#</a> Step 4 : REST Prototype</h2> <p>REST API 구현을 위해 User 오브젝트를 생성하고 GET, PUT, POST methods를 만들 것입니다.
REST API는 자원(Resource), 행위(Verb), 표현(Representations)으로 구성되어 있으며, 이 중 행위에 해당하는 HTTP methods 각 역할을 살펴보고 이를 기반으로 REST API 코드를 작성합니다.</p> <h3 id="http-methods-role"><a href="#http-methods-role" aria-hidden="true" class="header-anchor">#</a> Http Methods Role</h3> <table><thead><tr><th>HTTP Methods</th> <th>Role</th></tr></thead> <tbody><tr><td>POST</td> <td>해당 URI를 요청하면 리소스를 생성합니다.</td></tr> <tr><td>PUT</td> <td>해당 리소스를 수정합니다.</td></tr> <tr><td>GET</td> <td>해당 리소스를 조회합니다. 리소스를 조회하고 해당 도큐먼트에 대한 자세한 정보를 가져옵니다.</td></tr> <tr><td>DELETE</td> <td>리소스를 삭제합니다.</td></tr></tbody></table> <p>실습을 위해 아래 Tree대로 디렉토리 및 파일을 생성합니다.<br>
api 코드의 경우 버전 관리를 위해 v1 폴더 아래에서 관리합니다. 차후 v2, v3 방식으로 API 버전 관리가 가능합니다.</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>├── api
│   ├── index.js
│   └── v1                <span class="token comment"># create dir</span>
│       ├── index.js      <span class="token comment"># create file</span>
│       └── <span class="token function">users</span>         <span class="token comment"># create dir</span>
│           └── index.js  <span class="token comment"># create file</span>
├── package.json
├── serverless.yml
└── yarn.lock
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>/api/v1/users/index.js에 users에 대한 라우트 모듈을 작성합니다.</p> <h4 id="express-기본-tip"><a href="#express-기본-tip" aria-hidden="true" class="header-anchor">#</a> Express 기본 Tip</h4> <ul><li>라우팅은 애플리케이션 엔드 포인트(URI)의 정의, 그리고 URI가 클라이언트 요청에 응답하는 방식을 말합니다</li> <li>라우팅은 선언된 순서도 작동합니다.</li> <li>next 함수는 다음 라우팅으로 강제로 넘길때 사용됩니다.</li> <li>router 함수의 인자의 갯수에 따라서 맵핑되는 정보가 달라집니다. (err, req, res, next) 4개 인자가 모두 있는 경우에만 에러를 받을 수 있습니다.</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// api/v1/users/index.js</span>
<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> router <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// CRUD example</span>
router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'get users'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/:uid'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> uid <span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token punctuation">.</span>params
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'get user: '</span> <span class="token operator">+</span> uid<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'create user &gt; uid will be generated by server'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/:uid'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> uid <span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token punctuation">.</span>params
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'create user with uid: '</span><span class="token operator">+</span> uid<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

router<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'update(=&gt;replace) all users'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

router<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">'/:uid'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> uid <span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token punctuation">.</span>params
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'update(or upsert) user: '</span> <span class="token operator">+</span> uid<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

router<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'delete all users'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

router<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token string">'/:uid'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> uid <span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token punctuation">.</span>params
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'delete user: '</span> <span class="token operator">+</span> uid<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> router
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br></div></div><p>작성한 users 라우트 모듈을 v1 라우트 모듈에 포함 시킵니다.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// api/v1/index.js</span>
<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> router <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> routes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'users'</span><span class="token punctuation">]</span>

routes<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">route</span> <span class="token operator">=&gt;</span> router<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">'/'</span> <span class="token operator">+</span> route<span class="token punctuation">,</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./'</span> <span class="token operator">+</span> route<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> router
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>v1에 라우트 설정이 완료되면 최종적으로 v1 라우트 모듈을 express 미들웨어로 등록 시킵니다.</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> awsServerlessExpress <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'aws-serverless-express'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> v1 <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./v1'</span><span class="token punctuation">)</span>      <span class="token comment">// 추가</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">'/api/v1'</span><span class="token punctuation">,</span> v1<span class="token punctuation">)</span>          <span class="token comment">// 추가</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/api/ping'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> ping<span class="token punctuation">:</span> <span class="token string">'pong~'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> server <span class="token operator">=</span> awsServerlessExpress<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span>app<span class="token punctuation">)</span>

exports<span class="token punctuation">.</span><span class="token function-variable function">handler</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">event<span class="token punctuation">,</span> context</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> awsServerlessExpress<span class="token punctuation">.</span><span class="token function">proxy</span><span class="token punctuation">(</span>server<span class="token punctuation">,</span> event<span class="token punctuation">,</span> context<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>Postman으로 각 URI에 대한 테스트를 진행합니다.</p> <h3 id="get-result"><a href="#get-result" aria-hidden="true" class="header-anchor">#</a> GET Result</h3> <p><img src="/assets/img/step4-get.f9cbb463.png" alt></p> <h3 id="get-by-uid"><a href="#get-by-uid" aria-hidden="true" class="header-anchor">#</a> GET By UID</h3> <p><img src="/assets/img/step4-get-uid.2beb679c.png" alt></p> <h3 id="post-result"><a href="#post-result" aria-hidden="true" class="header-anchor">#</a> POST Result</h3> <p><img src="/assets/img/step4-post.6632cebb.png" alt></p> <h3 id="post-by-uid"><a href="#post-by-uid" aria-hidden="true" class="header-anchor">#</a> POST By UID</h3> <p><img src="/assets/img/step4-post-uid.ac4cec45.png" alt></p> <h3 id="put-result"><a href="#put-result" aria-hidden="true" class="header-anchor">#</a> PUT Result</h3> <p><img src="/assets/img/step4-put.39c5790e.png" alt></p> <h3 id="put-by-uid-result"><a href="#put-by-uid-result" aria-hidden="true" class="header-anchor">#</a> PUT By UID Result</h3> <p><img src="/assets/img/step4-put-uid.0a5e977b.png" alt></p> <h3 id="delete-result"><a href="#delete-result" aria-hidden="true" class="header-anchor">#</a> DELETE Result</h3> <p><img src="/assets/img/step4-delete.c893b61b.png" alt></p> <h3 id="delete-by-uid-result"><a href="#delete-by-uid-result" aria-hidden="true" class="header-anchor">#</a> DELETE By UID Result</h3> <p><img src="/assets/img/step4-delete-uid.6797ec40.png" alt></p> <h2 id="step-5-error-handling"><a href="#step-5-error-handling" aria-hidden="true" class="header-anchor">#</a> Step 5 : Error Handling</h2> <p>REST API 작성이 완료되면 Error 처리를 위한 미들웨어를 작성합니다. error.js 파일을 생성하고 에러 핸들링 코드를 작성합니다.</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>├── api
│   ├── index.js
│   ├── utils         <span class="token comment"># create dir</span>
│   │   └── error.js  <span class="token comment"># create file</span>
│   └── v1
│       ├── index.js
│       └── <span class="token function">users</span>
│           └── index.js
├── package.json
├── serverless.yml
└── yarn.lock
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// api/utils/error.js</span>
<span class="token keyword">class</span> <span class="token class-name">ApiError</span> <span class="token keyword">extends</span> <span class="token class-name">Error</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">code<span class="token punctuation">,</span> name<span class="token punctuation">,</span> message</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>Error<span class="token punctuation">.</span>captureStackTrace<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      Error<span class="token punctuation">.</span><span class="token function">captureStackTrace</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> ApiError<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>code <span class="token operator">=</span> code
    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> ApiError
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>작성한 모듈을 express 미들웨어로 등록합니다.<br>
express는 순서대로 실행되기 때문에 에러 핸들러는 가장 하단에서 처리해야 하며 err 인자를 받기 위해선 4개의 파라메터를 모두 명시해야합니다.</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> awsServerlessExpress <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'aws-serverless-express'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> ApiError <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./utils/error'</span><span class="token punctuation">)</span>   <span class="token comment">// 추가</span>
<span class="token keyword">const</span> v1 <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./v1'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">'/api/v1'</span><span class="token punctuation">,</span> v1<span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/api/ping'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> ping<span class="token punctuation">:</span> <span class="token string">'pong~'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">// Error Handling 추가</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
  <span class="token keyword">const</span> error <span class="token operator">=</span> <span class="token punctuation">{</span>
    code<span class="token punctuation">:</span> <span class="token number">500</span><span class="token punctuation">,</span>
    name<span class="token punctuation">:</span> <span class="token string">'internal-server-error'</span><span class="token punctuation">,</span>
    message<span class="token punctuation">:</span> err<span class="token punctuation">.</span>message
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>err <span class="token keyword">instanceof</span> <span class="token class-name">ApiError</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    error<span class="token punctuation">.</span>code <span class="token operator">=</span> err<span class="token punctuation">.</span>code
    error<span class="token punctuation">.</span>name <span class="token operator">=</span> err<span class="token punctuation">.</span>name
  <span class="token punctuation">}</span>
  res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span>error<span class="token punctuation">.</span>code<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span> error <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> server <span class="token operator">=</span> awsServerlessExpress<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span>app<span class="token punctuation">)</span>

exports<span class="token punctuation">.</span><span class="token function-variable function">handler</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">event<span class="token punctuation">,</span> context</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> awsServerlessExpress<span class="token punctuation">.</span><span class="token function">proxy</span><span class="token punctuation">(</span>server<span class="token punctuation">,</span> event<span class="token punctuation">,</span> context<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><p>이제 테스트를 위해 /api/v1/users/index.js 모듈에 에러를 유발하는 코드를 작성합니다.<br>
기존 작성되어 있는 코드 중 get/:uid, post/:uid 라우트 메소드에 uid가 값이 admin일 경우 에러를 발생시키는 코드를 넣어보겠습니다.</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> ApiError <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../../utils/error'</span><span class="token punctuation">)</span>   <span class="token comment">// Error 모듈 추가</span>
<span class="token keyword">const</span> router <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/:uid'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> uid <span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token punctuation">.</span>params

  <span class="token comment">// 일반 Error Handling 추가</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>uid <span class="token operator">===</span> <span class="token string">'admin'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'uid cannot be admin'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'create user with uid: '</span><span class="token operator">+</span> uid<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

router<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">'/:uid'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> uid <span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token punctuation">.</span>params

  <span class="token comment">// Custom Error Handling 추가</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>uid <span class="token operator">===</span> <span class="token string">'admin'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ApiError</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">,</span> <span class="token string">'bad-request'</span><span class="token punctuation">,</span> <span class="token string">'uid cannot be admin'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'update(or upsert) user: '</span> <span class="token operator">+</span> uid<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> router
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><p>수정한 API를 Postman으로 호출해봅니다.</p> <h4 id="error-result"><a href="#error-result" aria-hidden="true" class="header-anchor">#</a> Error Result</h4> <p><img src="/assets/img/step5-error.7ded53b0.png" alt></p> <h4 id="apierror-result"><a href="#apierror-result" aria-hidden="true" class="header-anchor">#</a> ApiError Result</h4> <p><img src="/assets/img/step5-api-error.a332dd4d.png" alt></p> <h3 id="error-tips"><a href="#error-tips" aria-hidden="true" class="header-anchor">#</a> Error Tips</h3> <p>Error Handler에 정상적으로 예외를 처리하기 위해선 next()를 호출해야합니다.<br>
비동기 함수에서 throw new Error('msg')로 바로 에러를 던질 경우 정상적으로 동작하지 않습니다.<br>
또한 에러 처리를 위한 next() 호출 시 현재 진행 중인 flow를 중단하기 위해 return next()와 같이 처리합니다.</p> <h2 id="step-6-database-setup"><a href="#step-6-database-setup" aria-hidden="true" class="header-anchor">#</a> Step 6 : Database Setup</h2> <p>Database 연결을 위해 Amazon RDS 서비스에서 Aurora DB를 생성합니다.</p> <p><img src="/assets/img/step6-create.8ff3b4e3.png" alt></p> <p>DB 연결을 위한 모듈을 작성합니다. /api/utils 에 다음 파일들을 생성하고 코드를 작성합니다.</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>├── api
│   ├── index.js
│   ├── utils
│   │   ├── error.js
│   │   ├── mysql.js      <span class="token comment"># create file - DB 모듈</span>
│   │   └── secret.js     <span class="token comment"># create file - DB 인증 정보</span>
│   └── v1
│       ├── index.js
│       ├── setup         <span class="token comment"># create dir</span>
│       │   └── index.js  <span class="token comment"># create file</span>
│       └── <span class="token function">users</span>
│           └── index.js
├── package.json
├── serverless.yml
└── yarn.lock
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// api/utils/secret.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  host     <span class="token punctuation">:</span> <span class="token string">'xxxxx.ap-northeast-2.rds.amazonaws.com'</span><span class="token punctuation">,</span>    <span class="token comment">// DB Endpoint</span>
  database <span class="token punctuation">:</span> <span class="token string">'serverless_tutorial'</span><span class="token punctuation">,</span>                       <span class="token comment">// DB Name</span>
  user     <span class="token punctuation">:</span> <span class="token string">'admin'</span><span class="token punctuation">,</span>                                     <span class="token comment">// DB User</span>
  password <span class="token punctuation">:</span> <span class="token string">'SuperSecret'</span>                                <span class="token comment">// DB Password</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// api/utils/mysql.js</span>
<span class="token keyword">const</span> secret <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./secret'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> mysql <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'serverless-mysql'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
mysql<span class="token punctuation">.</span><span class="token function">config</span><span class="token punctuation">(</span>secret<span class="token punctuation">)</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> mysql
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// api/v1/setup/index.js</span>
<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> router <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> mysql <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../../utils/mysql'</span><span class="token punctuation">)</span>

router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token comment">// create table: users</span>
    <span class="token keyword">await</span> mysql<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">'DROP TABLE IF EXISTS users'</span><span class="token punctuation">)</span>
    <span class="token keyword">await</span> mysql<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`CREATE TABLE users (
      uid 	VARCHAR(64) NOT NULL,
      name	VARCHAR(64) NOT NULL,
      level	INT NOT NULL
    )`</span></span><span class="token punctuation">)</span>
    <span class="token comment">// create table: user_items</span>
    <span class="token keyword">await</span> mysql<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">'DROP TABLE IF EXISTS user_items'</span><span class="token punctuation">)</span>
    <span class="token keyword">await</span> mysql<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`CREATE TABLE user_items (
      id    BIGINT NOT NULL AUTO_INCREMENT,
      uid   VARCHAR(64) NOT NULL,
      name	VARCHAR(64) NOT NULL,
      cost	INT NOT NULL,
      PRIMARY KEY(id)
    )`</span></span><span class="token punctuation">)</span>
    <span class="token comment">// create table: events</span>
    <span class="token keyword">await</span> mysql<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">'DROP TABLE IF EXISTS events'</span><span class="token punctuation">)</span>
    <span class="token keyword">await</span> mysql<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`CREATE TABLE events (
      id      BIGINT NOT NULL AUTO_INCREMENT,
      title	  VARCHAR(64) NOT NULL,
      message	VARCHAR(1024) NOT NULL,
      score   INT NOT NULL,
      status  VARCHAR(64) NOT NULL,
      PRIMARY KEY(id)
    )`</span></span><span class="token punctuation">)</span>
    <span class="token comment">// result</span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span> result<span class="token punctuation">:</span> <span class="token string">'success'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">next</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> router
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br></div></div><p>v1 라우트 모듈에 setup 모듈을 포함시킵니다.</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// api/v1/index.js</span>
<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> router <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> routes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'setup'</span><span class="token punctuation">,</span> <span class="token string">'users'</span><span class="token punctuation">]</span>   <span class="token comment">// setup 추가</span>

routes<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">route</span> <span class="token operator">=&gt;</span> router<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">'/'</span> <span class="token operator">+</span> route<span class="token punctuation">,</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./'</span> <span class="token operator">+</span> route<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> router
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>새로 추가된 /api/v1/setup 라우트 메소드를 호출하여 정상적으로 결과가 나오는지 확인합니다.</p> <p><img src="/assets/img/step6-create-table.77b2de0f.png" alt></p> <p><img src="/assets/img/step6-result.c4c5d995.png" alt></p> <h2 id="step-7-user-crud"><a href="#step-7-user-crud" aria-hidden="true" class="header-anchor">#</a> Step 7 : User CRUD</h2> <p>본 스텝에선 앞서 만들었던 users 모듈에 DB 모듈을 연동하여 CRUD를 구현합니다.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// /api/users/index.js</span>
<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> ApiError <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../../utils/error'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> router <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> mysql <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../../utils/mysql'</span><span class="token punctuation">)</span>

router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> users <span class="token operator">=</span> <span class="token keyword">await</span> mysql<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">'SELECT * FROM users'</span><span class="token punctuation">)</span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>users<span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">next</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/:uid'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> uid <span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token punctuation">.</span>params
    <span class="token keyword">const</span> users <span class="token operator">=</span> <span class="token keyword">await</span> mysql<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`SELECT * FROM users WHERE uid='</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>uid<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">'`</span></span><span class="token punctuation">)</span>
    users<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">?</span> res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>users<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">next</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/:uid'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> uid <span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token punctuation">.</span>params
    <span class="token keyword">const</span> <span class="token punctuation">{</span> name <span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token punctuation">.</span>body
    <span class="token comment">// validation</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>name <span class="token operator">||</span> name<span class="token punctuation">.</span>length <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ApiError</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">,</span> <span class="token string">'bad-request'</span><span class="token punctuation">,</span> <span class="token string">'Name cannot be empty and must be at least 3 characters.'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// initial value</span>
    <span class="token keyword">const</span> level <span class="token operator">=</span> <span class="token number">1</span>
    <span class="token comment">// insert</span>
    <span class="token keyword">await</span> mysql<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`INSERT INTO users VALUES ('</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>uid<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">', '</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">', </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>level<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)`</span></span><span class="token punctuation">)</span>
    <span class="token comment">// return object created</span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span> uid<span class="token punctuation">,</span> name<span class="token punctuation">,</span> level <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">next</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

router<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">'/:uid'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> uid <span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token punctuation">.</span>params
    <span class="token keyword">let</span> <span class="token punctuation">{</span> level <span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token punctuation">.</span>body
    <span class="token comment">// validation</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>level<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ApiError</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">,</span> <span class="token string">'bad-request'</span><span class="token punctuation">,</span> <span class="token string">'No Params.'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    level <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>level<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>level <span class="token operator">&gt;</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ApiError</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">,</span> <span class="token string">'bad-request'</span><span class="token punctuation">,</span> <span class="token string">'Black User'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment">// update</span>
    <span class="token keyword">await</span> mysql<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`UPDATE users SET level=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>level<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> WHERE uid='</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>uid<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">'`</span></span><span class="token punctuation">)</span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span> level <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">next</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> router
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br></div></div><h4 id="test-case-1-post-user"><a href="#test-case-1-post-user" aria-hidden="true" class="header-anchor">#</a> Test Case 1 - Post User</h4> <p><img src="/assets/img/step7-post-user.c3e84257.png" alt></p> <h4 id="test-case-2-put-user"><a href="#test-case-2-put-user" aria-hidden="true" class="header-anchor">#</a> Test Case 2 - Put User</h4> <p><img src="/assets/img/step7-put-user.afdd6ce0.png" alt></p> <h4 id="test-case-3-get-users"><a href="#test-case-3-get-users" aria-hidden="true" class="header-anchor">#</a> Test Case 3 - Get Users</h4> <p><img src="/assets/img/step7-get-user.45716b48.png" alt></p> <h4 id="test-case-3-get-user-info"><a href="#test-case-3-get-user-info" aria-hidden="true" class="header-anchor">#</a> Test Case 3 - Get User Info</h4> <p><img src="/assets/img/step7-get-user-uid.7d3fcd46.png" alt></p> <h2 id="step-8-extract-filter-sort-pagination"><a href="#step-8-extract-filter-sort-pagination" aria-hidden="true" class="header-anchor">#</a> Step 8 : Extract, Filter, Sort, Pagination</h2> <p>본 스텝에선 REST API에서 추출, 필터, 소트, 페이징에 대한 내용을 기술합니다.</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>├── api
│   ├── index.js
│   ├── utils
│   │   ├── error.js
│   │   ├── mysql.js
│   │   └── secret.js
│   └── v1
│       ├── events        <span class="token comment"># create dir</span>
│       │   └── index.js  <span class="token comment"># create file</span>
│       ├── index.js
│       ├── setup
│       │   └── index.js
│       └── <span class="token function">users</span>
│           └── index.js
├── package.json
├── serverless.yml
└── yarn.lock
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// api/v1/events/index.js</span>
<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> router <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> mysql <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../../utils/mysql'</span><span class="token punctuation">)</span>

router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'test'</span><span class="token punctuation">)</span>
    <span class="token keyword">let</span> <span class="token punctuation">{</span> fields<span class="token punctuation">,</span> status<span class="token punctuation">,</span> id<span class="token punctuation">,</span> sort<span class="token punctuation">,</span> limit<span class="token punctuation">,</span> offset <span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token punctuation">.</span>query
    <span class="token comment">// Extract</span>
    fields <span class="token operator">=</span> fields <span class="token operator">||</span> <span class="token string">'*'</span>
    <span class="token keyword">let</span> query <span class="token operator">=</span> <span class="token template-string"><span class="token string">`SELECT </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>fields<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> FROM events`</span></span>
    <span class="token comment">// Filter: match</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>status<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      query <span class="token operator">+=</span> <span class="token template-string"><span class="token string">` WHERE status = '</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>status<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">'`</span></span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Filter: range (id=lt:3, id=gt:4, id=in:3:5)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> idFilter <span class="token operator">=</span> id<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">':'</span><span class="token punctuation">)</span>
      <span class="token keyword">const</span> delimiter <span class="token operator">=</span> idFilter<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
      <span class="token keyword">const</span> lhs <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>idFilter<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>
      <span class="token keyword">const</span> rhs <span class="token operator">=</span> idFilter<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">?</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>idFilter<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token number">0</span>
      query <span class="token operator">+=</span> status <span class="token operator">?</span> <span class="token string">' AND '</span> <span class="token punctuation">:</span> <span class="token string">' WHERE '</span>
      <span class="token keyword">switch</span><span class="token punctuation">(</span>delimiter<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">case</span> <span class="token string">'lt'</span><span class="token punctuation">:</span>
          query <span class="token operator">+=</span> <span class="token template-string"><span class="token string">`id &lt; </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>lhs<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span>
          <span class="token keyword">break</span>
        <span class="token keyword">case</span> <span class="token string">'gt'</span><span class="token punctuation">:</span>
          query <span class="token operator">+=</span> <span class="token template-string"><span class="token string">`id &gt; </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>lhs<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span>
          <span class="token keyword">break</span>
        <span class="token keyword">case</span> <span class="token string">'in'</span><span class="token punctuation">:</span>
          query <span class="token operator">+=</span> <span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>lhs<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> &lt;= id AND id &lt;= </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>rhs<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span>
          <span class="token keyword">break</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Sort</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>sort<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      query <span class="token operator">+=</span> <span class="token template-string"><span class="token string">` ORDER BY </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>sort<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Pagination</span>
    limit <span class="token operator">=</span> limit <span class="token operator">||</span> <span class="token number">100</span> <span class="token comment">// default limit(or you can set max limit)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>limit<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      query <span class="token operator">+=</span> <span class="token template-string"><span class="token string">` LIMIT </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>limit<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>offset<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      query <span class="token operator">+=</span> <span class="token template-string"><span class="token string">` OFFSET </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>offset<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span>
    <span class="token punctuation">}</span>

    <span class="token keyword">const</span> events <span class="token operator">=</span> <span class="token keyword">await</span> mysql<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>events<span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">next</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token comment">// Authentication: Pseudo  code</span>
    <span class="token comment">// if (!isAdmin) return next(new ApiError(403, 'forbidden', 'Not Authorized.'))</span>

    <span class="token keyword">let</span> <span class="token punctuation">{</span> title<span class="token punctuation">,</span> message<span class="token punctuation">,</span> status<span class="token punctuation">,</span> score <span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token punctuation">.</span>body
    <span class="token keyword">const</span> <span class="token punctuation">{</span> insertId<span class="token punctuation">:</span> id <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> mysql<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`INSERT INTO events(title, message, score, status) VALUES ('</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>title<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">', '</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>message<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">', '</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>score<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">', '</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>status<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">')`</span></span><span class="token punctuation">)</span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span> id<span class="token punctuation">,</span> title<span class="token punctuation">,</span> message<span class="token punctuation">,</span> status<span class="token punctuation">,</span> score <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">next</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

router<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">'/:id'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token comment">// Authentication: Pseudo  code</span>
    <span class="token comment">// if (!isAdmin) return next(new ApiError(403, 'forbidden', 'Not Authorized.'))</span>

    <span class="token keyword">const</span> <span class="token punctuation">{</span> id <span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token punctuation">.</span>parmas
    <span class="token keyword">const</span> <span class="token punctuation">{</span> open <span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token punctuation">.</span>body
    <span class="token keyword">await</span> mysql<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`UPDATE events SET open = </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>open<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> WHERE id = </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span> id<span class="token punctuation">,</span> open <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">next</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> router
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br></div></div><p>v1 라우트 모듈에 events 모듈을 포함시킵니다.</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// api/v1/index.js</span>
<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> router <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> routes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'setup'</span><span class="token punctuation">,</span> <span class="token string">'users'</span><span class="token punctuation">,</span> <span class="token string">'events'</span><span class="token punctuation">]</span>   <span class="token comment">// events 추가</span>

routes<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">route</span> <span class="token operator">=&gt;</span> router<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">'/'</span> <span class="token operator">+</span> route<span class="token punctuation">,</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./'</span> <span class="token operator">+</span> route<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> router
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h4 id="test-case-1-post를-통한-기본-데이터-입력-정렬을-위해-예제와-동일하게-3개-정도-입력합니다"><a href="#test-case-1-post를-통한-기본-데이터-입력-정렬을-위해-예제와-동일하게-3개-정도-입력합니다" aria-hidden="true" class="header-anchor">#</a> Test Case 1 - POST를 통한 기본 데이터 입력. 정렬을 위해 예제와 동일하게 3개 정도 입력합니다.</h4> <h5 id="event1-open"><a href="#event1-open" aria-hidden="true" class="header-anchor">#</a> event1-open</h5> <p><img src="/assets/img/step8-01.d24cbb11.png" alt></p> <h5 id="event2-close"><a href="#event2-close" aria-hidden="true" class="header-anchor">#</a> event2-close</h5> <p><img src="/assets/img/step8-02.f875df8c.png" alt></p> <h5 id="event3-open"><a href="#event3-open" aria-hidden="true" class="header-anchor">#</a> event3-open</h5> <p><img src="/assets/img/step8-03.c9023980.png" alt></p> <h4 id="test-case-2-extract"><a href="#test-case-2-extract" aria-hidden="true" class="header-anchor">#</a> Test Case 2 - Extract</h4> <h5 id="모든-유저-반환"><a href="#모든-유저-반환" aria-hidden="true" class="header-anchor">#</a> 모든 유저 반환</h5> <p><img src="/assets/img/step8-get-users.ff58889c.png" alt></p> <h5 id="유저-리스트에서-id-title-필드만-추출"><a href="#유저-리스트에서-id-title-필드만-추출" aria-hidden="true" class="header-anchor">#</a> 유저 리스트에서 id, title 필드만 추출</h5> <p><img src="/assets/img/step8-extract.0f82bbbd.png" alt></p> <h5 id="유저-리스트에서-status가-open인-유저만-추출"><a href="#유저-리스트에서-status가-open인-유저만-추출" aria-hidden="true" class="header-anchor">#</a> 유저 리스트에서 status가 open인 유저만 추출</h5> <p><img src="/assets/img/step8-status-open.54de1e79.png" alt></p> <h5 id="유저-리스트에서-id가-3보다-작은-그룹-lt-3"><a href="#유저-리스트에서-id가-3보다-작은-그룹-lt-3" aria-hidden="true" class="header-anchor">#</a> 유저 리스트에서 id가 3보다 작은 그룹 (lt:3)</h5> <p><img src="/assets/img/step8-user-lt.ab72882e.png" alt></p> <h5 id="유저-리스트에서-id가-2와-3을-포함하는-그룹-in-2-3"><a href="#유저-리스트에서-id가-2와-3을-포함하는-그룹-in-2-3" aria-hidden="true" class="header-anchor">#</a> 유저 리스트에서 id가 2와 3을 포함하는 그룹 (in:2:3)</h5> <p><img src="/assets/img/step8-user-in.1ab41801.png" alt></p> <h4 id="test-case-3-sort"><a href="#test-case-3-sort" aria-hidden="true" class="header-anchor">#</a> Test Case 3 - Sort</h4> <h5 id="유저-리스트에서-score-순으로-정렬"><a href="#유저-리스트에서-score-순으로-정렬" aria-hidden="true" class="header-anchor">#</a> 유저 리스트에서 score 순으로 정렬</h5> <p><img src="/assets/img/step8-sort.e6b1632b.png" alt></p> <h4 id="test-case-4-pagination"><a href="#test-case-4-pagination" aria-hidden="true" class="header-anchor">#</a> Test Case 4 - Pagination</h4> <h5 id="유저-리스트-1번째-row를-시작으로-2개-선택"><a href="#유저-리스트-1번째-row를-시작으로-2개-선택" aria-hidden="true" class="header-anchor">#</a> 유저 리스트 1번째 row를 시작으로 2개 선택</h5> <p><img src="/assets/img/step8-page.25ff2088.png" alt></p> <h2 id="step-9-nested-route"><a href="#step-9-nested-route" aria-hidden="true" class="header-anchor">#</a> Step 9 : Nested Route</h2> <p>본 스텝에선 중첩퇸 라우트를 구현합니다.</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>├── api
│   ├── index.js
│   ├── utils
│   │   ├── error.js
│   │   ├── mysql.js
│   │   ├── secret.js
│   │   └── secret2.js
│   └── v1
│       ├── events
│       │   └── index.js
│       ├── index.js
│       ├── setup
│       │   └── index.js
│       └── <span class="token function">users</span>
│           ├── index.js
│           └── items         <span class="token comment"># create dir</span>
│               └── index.js  <span class="token comment"># create file</span>
├── package.json
├── serverless.yml
└── yarn.lock
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>express.Router의 mergeParams: true 옵션은 부모 라우트의 req.params 값을 전달받을 수 있게 합니다.<br>
본 예제에선 /api/v1/users/:uid/items로 넘어오는 :uid 값을 items에서 사용할 수 있게 됩니다.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// api/v1/users/items/index.js</span>
<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> router <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">{</span> mergeParams<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> mysql <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../../../utils/mysql'</span><span class="token punctuation">)</span>

router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> uid <span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token punctuation">.</span>params
    <span class="token keyword">const</span> items <span class="token operator">=</span> <span class="token keyword">await</span> mysql<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`SELECT * FROM user_items WHERE uid = '</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>uid<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">'`</span></span><span class="token punctuation">)</span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>items<span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">next</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/:itemId'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> uid<span class="token punctuation">,</span> itemId <span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token punctuation">.</span>params
    <span class="token keyword">const</span> items <span class="token operator">=</span> <span class="token keyword">await</span> mysql<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`SELECT * FROM user_items WHERE uid = '</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>uid<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">' AND id = </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>itemId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span>
    items<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">?</span> res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>items<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">next</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> uid <span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token punctuation">.</span>params
    <span class="token keyword">const</span> <span class="token punctuation">{</span> name<span class="token punctuation">,</span> cost <span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token punctuation">.</span>body

    <span class="token comment">// initial value</span>
    <span class="token keyword">const</span> level <span class="token operator">=</span> <span class="token number">1</span>
    <span class="token comment">// insert</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> insertId<span class="token punctuation">:</span> id <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> mysql<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`INSERT INTO user_items(uid, name, cost) VALUES ('</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>uid<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">', '</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">', </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>cost<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)`</span></span><span class="token punctuation">)</span>
    <span class="token comment">// return object created</span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span> id<span class="token punctuation">,</span> uid<span class="token punctuation">,</span> name<span class="token punctuation">,</span> cost <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">next</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> router
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br></div></div><p>users 라우트 모듈을 열고 새로 작성한 items 모듈을 추가한 후 코드 마지막 부분에 items 라우트를 users 라우터에 등록합니다.</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// api/v1/users/index.js</span>
<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> ApiError <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../../utils/error'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> router <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> mysql <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../../utils/mysql'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> items <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./items'</span><span class="token punctuation">)</span>     <span class="token comment">// 추가</span>

<span class="token comment">// 중간 생략 ...</span>

<span class="token comment">// Nested Route : items</span>
router<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">'/:uid/items'</span><span class="token punctuation">,</span> items<span class="token punctuation">)</span>     <span class="token comment">// 추가</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> router
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>이제 &quot;/api/v1/users/${mamh}/items&quot; 형식의 endpoint로 items API를 호출할 수 있습니다.</p> <h4 id="test-case-1-post-items-같은-방법으로-item2-item3-까지-만들어-줍니다"><a href="#test-case-1-post-items-같은-방법으로-item2-item3-까지-만들어-줍니다" aria-hidden="true" class="header-anchor">#</a> Test Case 1 - Post Items. 같은 방법으로 item2, item3 까지 만들어 줍니다.</h4> <p><img src="/assets/img/step9-post-item.14d60aea.png" alt></p> <h4 id="test-case-2-get-all-items"><a href="#test-case-2-get-all-items" aria-hidden="true" class="header-anchor">#</a> Test Case 2 - Get All Items</h4> <p><img src="/assets/img/step9-get-items.d2f2cd41.png" alt></p> <h4 id="test-case-3-get-item-info"><a href="#test-case-3-get-item-info" aria-hidden="true" class="header-anchor">#</a> Test Case 3 - Get Item Info</h4> <p><img src="/assets/img/step9-get-item-info.f9355ec9.png" alt></p> <h2 id="step-10-deploy"><a href="#step-10-deploy" aria-hidden="true" class="header-anchor">#</a> Step 10 : Deploy</h2> <p>본 스텝은 작성된 코드를 AWS에 배포하는 내용을 다룹니다.</p> <h3 id="사전-준비-iam"><a href="#사전-준비-iam" aria-hidden="true" class="header-anchor">#</a> 사전 준비 - IAM</h3> <p>배포에는 IAM 사용자 인증이 필요합니다. <a href="https://console.aws.amazon.com/iam/home?region=ap-northeast-2#/home" target="_blank" rel="noopener noreferrer">AWS Console<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>에 로그인 한 후 IAM 섹션으로 이동합니다.</p> <p>먼저 신규 IAM 사용자를 위한 그룹을 생성합니다.</p> <p><img src="/assets/img/step10-01.b7818965.png" alt></p> <p>그룹 이름을 설정합니다</p> <p><img src="/assets/img/step10-02.1e0fee55.png" alt></p> <p><strong>정책 연결 시 필요한 권한만 선택해야 하나 튜토리얼 편의상 전체 권한인 AdministratorAccess를 부여했습니다.<br>실 서비스 사용시엔 필요한 권한만 선택하세요</strong></p> <p><img src="/assets/img/step10-03.2828b446.png" alt></p> <p>그룹 생성을 완료합니다</p> <p><img src="/assets/img/step10-04.d21af381.png" alt></p> <p>이제 배포에 사용될 사용자 계정을 생성합니다.</p> <p><img src="/assets/img/step10-10.3a324729.png" alt></p> <p><strong>사용자 이름을 지정하고 프로그래밍 방식 엑세스를 선택합니다.<br>
해당 IAM은 console 명령어를 사용하지 않으므로 AWS Management Console 엑세스는 선택하지 않습니다</strong></p> <p><img src="/assets/img/step10-11.b3eed512.png" alt></p> <p>앞에서 만들어둔 그룹에 해당 사용자를 추가합니다.</p> <p><img src="/assets/img/step10-12.08d575ad.png" alt></p> <p>태그는 설정하지 않고 다음으로 이동 후 사용자 만들기를 선택합니다.</p> <p><img src="/assets/img/step10-13.39878bca.png" alt></p> <p><strong>엑세스 키 ID 및 비밀 엑세스 키를 메모장에 붙여둡니다.<br>
비밀 엑세스키는 이 단계가 넘어가면 재 확인이 불가능하나 신규 생성으로 재발급 가능하니 반드시 기억할 필요는 없습니다</strong> <img src="/assets/img/step10-14.049750cf.png" alt></p> <h3 id="사전-준비-serverless-auth"><a href="#사전-준비-serverless-auth" aria-hidden="true" class="header-anchor">#</a> 사전 준비 - Serverless Auth</h3> <p>Serverless Framework에서 사용하기 위한 인증 파일을 생성합니다.<br>
이 파일 생성을 위해 IAM 생성시 발급된 엑세스 키 ID 및 비밀 엑세스 키를 사용합니다.<br>
Serverless Framework는 aws 인증을 위해 ~/.aws/credentials 파일을 참조합니다.<br>
이 파일을 생성하는 방법은 aws-cli를 이용하거나 Serverless Framework에서 제공하는 cli를 통해 생성할 수 있습니다.<br>
이 챕터에선 Serverless Framework CLI로 진행하는 방법을 설명합니다.<br>
다음 명령어를 실행하여 AWS Credentials 파일을 생성합니다.</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ serverless config credentials --provider aws --key <span class="token operator">&lt;</span>엑세스 키 ID<span class="token operator">&gt;</span> --secret <span class="token operator">&lt;</span>비밀 엑세스 키<span class="token operator">&gt;</span> -o
Serverless: Setting up AWS<span class="token punctuation">..</span>.
Serverless: Saving your AWS profile <span class="token keyword">in</span> <span class="token string">&quot;~/.aws/credentials&quot;</span><span class="token punctuation">..</span>.
Serverless: Success<span class="token operator">!</span> Your AWS access keys were stored under the <span class="token string">&quot;default&quot;</span> profile.
$ <span class="token function">cat</span> ~/.aws/credentials
<span class="token punctuation">[</span>default<span class="token punctuation">]</span>
aws_access_key_id <span class="token operator">=</span> XXXXXXXXX
aws_secret_access_key <span class="token operator">=</span> XXXXXXXXXXX
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>모든 준비가 끝났습니다. 이제 deploy 명령어로 AWS에 배포를 진행합니다.</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ <span class="token function">yarn</span> deploy
<span class="token function">yarn</span> run v1.13.0
$ serverless deploy
Serverless: Packaging service<span class="token punctuation">..</span>.
Serverless: Excluding development dependencies<span class="token punctuation">..</span>.
Serverless: Creating Stack<span class="token punctuation">..</span>.
Serverless: Checking Stack create progress<span class="token punctuation">..</span>.
<span class="token punctuation">..</span><span class="token punctuation">..</span>.
Serverless: Stack create finished<span class="token punctuation">..</span>.
Serverless: Uploading CloudFormation <span class="token function">file</span> to S3<span class="token punctuation">..</span>.
Serverless: Uploading artifacts<span class="token punctuation">..</span>.
Serverless: Uploading <span class="token function">service</span> serverless-tutorial-dev.zip <span class="token function">file</span> to S3 <span class="token punctuation">(</span>2.92 MB<span class="token punctuation">)</span><span class="token punctuation">..</span>.
Serverless: Validating template<span class="token punctuation">..</span>.
Serverless: Updating Stack<span class="token punctuation">..</span>.
Serverless: Checking Stack update progress<span class="token punctuation">..</span>.
<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>
Serverless: Stack update finished<span class="token punctuation">..</span>.
Service Information
service: serverless-tutorial-dev
stage: prod
region: ap-northeast-2
stack: serverless-tutorial-dev-prod
resources: 10
api keys:
  None
endpoints:
  ANY - https://xv0lm0e8rk.execute-api.ap-northeast-2.amazonaws.com/prod/api/<span class="token punctuation">{</span>proxy+<span class="token punctuation">}</span>
functions:
  api: serverless-tutorial-dev-prod-api
layers:
  None
✨  Done <span class="token keyword">in</span> 89.79s.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><h4 id="배포-후-생성-확인-cloudformation"><a href="#배포-후-생성-확인-cloudformation" aria-hidden="true" class="header-anchor">#</a> 배포 후 생성 확인 - CloudFormation</h4> <p><img src="/assets/img/step10-formation.3008d2aa.png" alt></p> <h4 id="배포-후-생성-확인-api-gateway"><a href="#배포-후-생성-확인-api-gateway" aria-hidden="true" class="header-anchor">#</a> 배포 후 생성 확인 - API Gateway</h4> <p><img src="/assets/img/step10-gateway-01.5d8bb55f.png" alt></p> <p><img src="/assets/img/step10-gateway-02.77499373.png" alt></p> <h4 id="배포-후-생성-확인-lambda"><a href="#배포-후-생성-확인-lambda" aria-hidden="true" class="header-anchor">#</a> 배포 후 생성 확인 - Lambda</h4> <p><img src="/assets/img/step10-lambda-01.9a64f420.png" alt></p> <p><img src="/assets/img/step10-lambda-02.68b2963a.png" alt></p> <h3 id="test-case-lambda-endpoints-테스트"><a href="#test-case-lambda-endpoints-테스트" aria-hidden="true" class="header-anchor">#</a> Test Case - Lambda Endpoints 테스트</h3> <h5 id="endpoints로-api를-호출합니다-endpoints-확인을-위해-aws-lambda-서비스-페이지에서-api-gateway를-선택합니다"><a href="#endpoints로-api를-호출합니다-endpoints-확인을-위해-aws-lambda-서비스-페이지에서-api-gateway를-선택합니다" aria-hidden="true" class="header-anchor">#</a> Endpoints로 API를 호출합니다. Endpoints 확인을 위해 AWS Lambda 서비스 페이지에서 API Gateway를 선택합니다</h5> <p><img src="/assets/img/step10-endpoints.084bdf7e.png" alt></p> <h5 id="테스트-삼아-마지막에-로컬에서-테스트한-api의-endpoint를-변경하여-호출해봅니다"><a href="#테스트-삼아-마지막에-로컬에서-테스트한-api의-endpoint를-변경하여-호출해봅니다" aria-hidden="true" class="header-anchor">#</a> 테스트 삼아 마지막에 로컬에서 테스트한 API의 Endpoint를 변경하여 호출해봅니다.</h5> <p><img src="/assets/img/step10-endpoints-test.04b11b32.png" alt></p> <h2 id="bonus-step-11-jwt-token을-이용한-간단한-인증처리"><a href="#bonus-step-11-jwt-token을-이용한-간단한-인증처리" aria-hidden="true" class="header-anchor">#</a> (Bonus) Step 11 : JWT Token을 이용한 간단한 인증처리</h2> <p>JSON Web Token(JWT)은 웹표준 (RFC 7519) 으로서 사용자의 인증정보를 암호화하여 전달하고 확인 할 수 있는 방법을 제공합니다. <br>
본 스텝에선 JWT를 이용하여 인증하는 방법에 대해 간단하게 구현하는 내용을 담고 있습니다.<br></p> <h3 id="jwt-module-설치"><a href="#jwt-module-설치" aria-hidden="true" class="header-anchor">#</a> JWT Module 설치</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ <span class="token function">yarn</span> <span class="token function">add</span> express-jwt <span class="token comment"># or npm i express-jwt</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="api-작성"><a href="#api-작성" aria-hidden="true" class="header-anchor">#</a> API 작성</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>├── api
│   ├── index.js
│   ├── utils
│   │   ├── error.js
│   │   ├── mysql.js
│   │   └── secret.js
│   └── v1
│       ├── auth          <span class="token comment"># create dir</span>
│       │   └── login.js  <span class="token comment"># create file</span>
│       ├── events
│       │   └── index.js
│       ├── index.js
│       ├── setup
│       │   └── index.js
│       └── <span class="token function">users</span>
│           ├── index.js
│           └── items
│               └── index.js
├── package.json
├── serverless.yml
└── yarn.lock
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// api/v1/auth/login.js</span>
<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> jwt <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'jsonwebtoken'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> router <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> uid <span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token punctuation">.</span>body
  <span class="token keyword">const</span> token <span class="token operator">=</span> jwt<span class="token punctuation">.</span><span class="token function">sign</span><span class="token punctuation">(</span><span class="token punctuation">{</span> uid <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">'SUPERSECRET'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> expiresIn<span class="token punctuation">:</span> <span class="token string">'7d'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span> uid<span class="token punctuation">,</span> token <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> router
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>추가된 auth 모듈을 v1 라우트 모듈에 추가합니다.</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// api/v1/auth/index.js</span>
<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> router <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> routes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'setup'</span><span class="token punctuation">,</span> <span class="token string">'users'</span><span class="token punctuation">,</span> <span class="token string">'events'</span><span class="token punctuation">,</span> <span class="token string">'auth'</span><span class="token punctuation">]</span>   <span class="token comment">// auth 추가</span>

routes<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">route</span> <span class="token operator">=&gt;</span> router<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">'/'</span> <span class="token operator">+</span> route<span class="token punctuation">,</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./'</span> <span class="token operator">+</span> route<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> router
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>root index.js에 jwt 인증을 미들웨어로 등록합니다.<br>
이제 unless에 등록된 라우트를 제외한 모든 api는 jwt 토큰이 없으면 에러를 발생하게 됩니다.</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> awsServerlessExpress <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'aws-serverless-express'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> ApiError <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./utils/error'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> v1 <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./v1'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> jwt <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express-jwt'</span><span class="token punctuation">)</span>      <span class="token comment">// 추가</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">jwt</span><span class="token punctuation">(</span><span class="token punctuation">{</span> secret<span class="token punctuation">:</span> <span class="token string">'SUPERSECRET'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unless</span><span class="token punctuation">(</span><span class="token punctuation">{</span> path<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'/ping'</span><span class="token punctuation">,</span> <span class="token string">'/api/v1/auth/login'</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">// 추가</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> err<span class="token punctuation">.</span>name <span class="token operator">===</span> <span class="token string">'UnauthorizedError'</span> <span class="token operator">?</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ApiError</span><span class="token punctuation">(</span><span class="token number">401</span><span class="token punctuation">,</span> <span class="token string">'auth-error'</span><span class="token punctuation">,</span> err<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token comment">// 추가</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">'/api/v1'</span><span class="token punctuation">,</span> v1<span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/api/ping'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> ping<span class="token punctuation">:</span> <span class="token string">'pong~'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">// Error Handling</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
  <span class="token keyword">const</span> error <span class="token operator">=</span> <span class="token punctuation">{</span>
    code<span class="token punctuation">:</span> <span class="token number">500</span><span class="token punctuation">,</span>
    name<span class="token punctuation">:</span> <span class="token string">'internal-server-error'</span><span class="token punctuation">,</span>
    message<span class="token punctuation">:</span> err<span class="token punctuation">.</span>message
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>err <span class="token keyword">instanceof</span> <span class="token class-name">ApiError</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    error<span class="token punctuation">.</span>code <span class="token operator">=</span> err<span class="token punctuation">.</span>code
    error<span class="token punctuation">.</span>name <span class="token operator">=</span> err<span class="token punctuation">.</span>name
  <span class="token punctuation">}</span>
  res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span>error<span class="token punctuation">.</span>code<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span> error <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> server <span class="token operator">=</span> awsServerlessExpress<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span>app<span class="token punctuation">)</span>

exports<span class="token punctuation">.</span><span class="token function-variable function">handler</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">event<span class="token punctuation">,</span> context</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> awsServerlessExpress<span class="token punctuation">.</span><span class="token function">proxy</span><span class="token punctuation">(</span>server<span class="token punctuation">,</span> event<span class="token punctuation">,</span> context<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><p>이제 Login API를 호출하여 Token 발급 테스트를 진행합니다.<br>
UID를 인자로 전달하고 Token을 발급 받아 이후 API 통신에 인증 키로 활용될 수 있습니다.<br> <b>경고: 실무에서는 User의 실질적인 인증정보(ID,PWD 또는 OAuth등을 활용하여야 합니다.</b></p> <p><img src="/assets/img/step11-jwt.cad6a750.png" alt></p> <p>위에서 얻은 Token으로 users PUT Methods를 호출해봅니다.<br>
우선 Token이 없을 때의 결과 입니다.<br></p> <p><img src="/assets/img/step11-test-01.a3ceb612.png" alt></p> <p>이제 토큰 값을 추가하여 호출합니다. Postman의 Authorization 탭을 선택한 후 TYPE을 Bearer Token으로 지정합니다. 그리고 Token 입력 폼에 발급 받은 Token 값을 입력한 후 Preview Requests를 눌러 헤더 값을 설정 합니다.<br></p> <p><img src="/assets/img/step11-test-02.c04bfbe4.png" alt></p> <p>이제 users PUT method를 호출합니다. mamh UID의 level을 70으로 변경합니다.<br></p> <p><img src="/assets/img/step11-test-03.31df112b.png" alt></p> <h2 id="bonus-step-12-cron"><a href="#bonus-step-12-cron" aria-hidden="true" class="header-anchor">#</a> (Bonus) Step 12 : Cron</h2> <p>본 스텝은 Lambda를 이용하여 Cron (Scheduled Lambda)을 설정하는 방법을 기술합니다.<br>
우선 Cron을 돌리기 위한 스케쥴러를 작성합니다. 스케쥴러는 POST events API를 호출하여 이벤트를 1분마다 생성할 것입니다.</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token keyword">.</span>
├── api
│   ├── index.js
│   ├── utils
│   │   ├── error.js
│   │   ├── mysql.js
│   │   └── secret.js
│   └── v1
│       ├── auth
│       │   └── index.js
│       ├── events
│       │   └── index.js
│       ├── index.js
│       ├── setup
│       │   └── index.js
│       └── <span class="token function">users</span>
│           ├── index.js
│           └── items
│               └── index.js
├── package.json
├── scheduler             <span class="token comment"># create dir</span>
│   └── daily-events.js   <span class="token comment"># create file</span>
├── serverless.yml
└── yarn.lock
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p>아래 코드를 daily-events.js에 작성합니다.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// scheduler/daily-events.js</span>
<span class="token keyword">const</span> mysql <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../api/utils/mysql'</span><span class="token punctuation">)</span>

exports<span class="token punctuation">.</span><span class="token function-variable function">handler</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">event<span class="token punctuation">,</span> context</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> title <span class="token operator">=</span> <span class="token string">'cron_events'</span>
    <span class="token keyword">const</span> message <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toTimeString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> score <span class="token operator">=</span> <span class="token number">100</span>
    <span class="token keyword">const</span> status <span class="token operator">=</span> <span class="token string">'open'</span>
    <span class="token keyword">await</span> mysql<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`INSERT INTO events(title, message, score, status) VALUES ('</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>title<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">', '</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>message<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">', '</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>score<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">', '</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>status<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">')`</span></span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>serverless.yml 파일을 열고 스케쥴러에 대한 스크립트를 작성합니다.<br>
람다 크론식에 대해 자세히 알고 싶으시면 <a href="https://docs.aws.amazon.com/ko_kr/lambda/latest/dg/tutorial-scheduled-events-schedule-expressions.html" target="_blank" rel="noopener noreferrer">AWS rate 또는 cron을 사용한 예약 표현식<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>을 참고하도록 합니다.</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>service: serverless-tutorial
provider:
  name: aws
  runtime: nodejs8.10
  stage: prod             <span class="token comment"># optional, default: dev</span>
  region: ap-northeast-2	<span class="token comment"># optional, default: us-east-1</span>
  memorySize: 128         <span class="token comment"># optional, in MB, default: 1024</span>
  timeout: 30             <span class="token comment"># optional, in seconds, default: 6</span>
  versionFunctions: <span class="token boolean">false</span> <span class="token comment"># optional, default: true</span>
functions:
  api:
    name: <span class="token variable">${self:service}</span>-<span class="token variable">${self:provider.stage}</span>
    handler: api/index.handler
    events:
      - http: ANY /api/<span class="token punctuation">{</span>proxy+<span class="token punctuation">}</span>
  scheduler:  <span class="token comment"># 1분 마다 scheduler/daily-events.js가 실행되도록 추가</span>
    name: <span class="token variable">${self:service}</span>-<span class="token variable">${self:provider.stage}</span>-scheduler
    handler: scheduler/daily-events.handler
    events:
      - schedule:
          rate: cron<span class="token punctuation">(</span>*/1 * ? * * *<span class="token punctuation">)</span>
          enabled: <span class="token boolean">true</span>
plugins:
  - serverless-offline
  - serverless-offline-scheduler
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p>yarn dev 명령어를 실행하여 콘솔 로그를 확인합니다.</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ <span class="token function">yarn</span> dev
<span class="token function">yarn</span> run v1.13.0
$ serverless offline start
Serverless: scheduler: scheduling scheduler/scheduler with */1 * ? * *
Serverless: Starting Offline: prod/ap-northeast-2.

Serverless: Routes <span class="token keyword">for</span> api:
Serverless: ANY /api/<span class="token punctuation">{</span>proxy*<span class="token punctuation">}</span>

Serverless: Routes <span class="token keyword">for</span> scheduler:
Serverless: <span class="token punctuation">(</span>none<span class="token punctuation">)</span>

Serverless: Offline listening on http://localhost:3000
Serverless: scheduler: running scheduled job: scheduler
Serverless: scheduler: running scheduled job: scheduler
Serverless: scheduler: running scheduled job: scheduler
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>DB에 데이터를 확인해봅니다.<br></p> <p><img src="/assets/img/step12-01.f926c6cf.png" alt></p> <p>yarn deploy를 실행하여 배포를 진행합니다.</p> <p>결과 화면에 scheduler가 추가된 것을 확인할 수 있습니다.</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ <span class="token function">yarn</span> deploy
<span class="token function">yarn</span> run v1.13.0
$ serverless deploy
Serverless: Packaging service<span class="token punctuation">..</span>.
Serverless: Excluding development dependencies<span class="token punctuation">..</span>.
Serverless: Uploading CloudFormation <span class="token function">file</span> to S3<span class="token punctuation">..</span>.
Serverless: Uploading artifacts<span class="token punctuation">..</span>.
Serverless: Uploading <span class="token function">service</span> serverless-tutorial-dev.zip <span class="token function">file</span> to S3 <span class="token punctuation">(</span>4.36 MB<span class="token punctuation">)</span><span class="token punctuation">..</span>.
Serverless: Validating template<span class="token punctuation">..</span>.
Serverless: Updating Stack<span class="token punctuation">..</span>.
Serverless: Checking Stack update progress<span class="token punctuation">..</span>.
<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>
Serverless: Stack update finished<span class="token punctuation">..</span>.
Service Information
service: serverless-tutorial-dev
stage: prod
region: ap-northeast-2
stack: serverless-tutorial-dev-prod
resources: 14
api keys:
  None
endpoints:
  ANY - https://xv0lm0e8rk.execute-api.ap-northeast-2.amazonaws.com/prod/api/<span class="token punctuation">{</span>proxy+<span class="token punctuation">}</span>
functions:
  api: serverless-tutorial-dev-prod-api
  scheduler: serverless-tutorial-dev-prod-scheduler
layers:
  None
Serverless: Removing old <span class="token function">service</span> artifacts from S3<span class="token punctuation">..</span>.
✨  Done <span class="token keyword">in</span> 88.06s.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><p>AWS Lambda 서비스 페이지에서 모니터링 탭을 선택하여 제대로 호출되고 있는지 확인합니다.<br>
Invocations가 증가하는 모습을 확인할 수 있습니다.</p> <p><img src="/assets/img/step12-02.dbaddcb8.png" alt></p> <h2 id="bonus-step-13-breakpoint"><a href="#bonus-step-13-breakpoint" aria-hidden="true" class="header-anchor">#</a> (Bonus) Step 13 : BreakPoint</h2> <p>VSCode를 이용하여 BreakPoint로 디버깅하는 방법에 대해 소개합니다.<br></p> <h4 id="package-json-scripts에-debug-스크립트를-추가"><a href="#package-json-scripts에-debug-스크립트를-추가" aria-hidden="true" class="header-anchor">#</a> package.json - scripts에 debug 스크립트를 추가</h4> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token string">&quot;scripts&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
  <span class="token string">&quot;dev&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;serverless offline start&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;deploy&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;serverless deploy&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;debug&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;export SLS_DEBUG=* &amp;&amp; node --debug ./node_modules/serverless/bin/serverless offline -s dev&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="vscode-left-menu에서-debug-menu를-선택합니다"><a href="#vscode-left-menu에서-debug-menu를-선택합니다" aria-hidden="true" class="header-anchor">#</a> VSCode Left Menu에서 Debug Menu를 선택합니다.</h4> <p><img src="/assets/img/step13-01.c6aeb230.png" alt></p> <h4 id="상단-no-configuration을-누르고-add-configuration을-선택합니다"><a href="#상단-no-configuration을-누르고-add-configuration을-선택합니다" aria-hidden="true" class="header-anchor">#</a> 상단 No Configuration을 누르고 Add Configuration을 선택합니다.</h4> <p><img src="/assets/img/step13-02.9eb97120.png" alt></p> <h4 id="node-js를-선택하면-laugnch-json-파일이-생성됩니다"><a href="#node-js를-선택하면-laugnch-json-파일이-생성됩니다" aria-hidden="true" class="header-anchor">#</a> Node.js를 선택하면 laugnch.json 파일이 생성됩니다.</h4> <p><img src="/assets/img/step13-03.72fb2f35.png" alt></p> <h4 id="다음-코드를-launch-json에-작성합니다"><a href="#다음-코드를-launch-json에-작성합니다" aria-hidden="true" class="header-anchor">#</a> 다음 코드를 launch.json에 작성합니다.</h4> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token punctuation">{</span>
  <span class="token string">&quot;version&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;0.2.0&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;configurations&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token string">&quot;type&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;node&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;request&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;launch&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;name&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;Serverless&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;program&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;${workspaceFolder}/node_modules/serverless/bin/serverless&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;cwd&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;${workspaceFolder}&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;args&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
        <span class="token string">&quot;offline&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;start&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;--stage=development&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;--region=us-west-2&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;--host=localhost&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;--port=3000&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;--noTimeout&quot;</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token string">&quot;sourceMaps&quot;</span><span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token string">&quot;smartStep&quot;</span><span class="token punctuation">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p><img src="/assets/img/step13-04.def6b3c3.png" alt></p> <h5 id="이제-auth-login-api를-디버깅해보겠습니다-api-v1-auth-index-js을-열고-8번-줄-const-token-변수에-브레이킹-포인트를-잡습니다-f9-키-혹은-스크린샷-빨간-점-부분-마우스로-선택"><a href="#이제-auth-login-api를-디버깅해보겠습니다-api-v1-auth-index-js을-열고-8번-줄-const-token-변수에-브레이킹-포인트를-잡습니다-f9-키-혹은-스크린샷-빨간-점-부분-마우스로-선택" aria-hidden="true" class="header-anchor">#</a> 이제 auth/login API를 디버깅해보겠습니다. /api/v1/auth/index.js을 열고 8번 줄 const token 변수에 브레이킹 포인트를 잡습니다. (F9 키 혹은 스크린샷 빨간 점 부분 마우스로 선택)</h5> <p><img src="/assets/img/step13-05.599b96f7.png" alt></p> <h4 id="왼쪽-상단-debug-버튼을-누르면-debugging-watch가-시작됩니다"><a href="#왼쪽-상단-debug-버튼을-누르면-debugging-watch가-시작됩니다" aria-hidden="true" class="header-anchor">#</a> 왼쪽 상단 DEBUG 버튼을 누르면 Debugging Watch가 시작됩니다.</h4> <p><img src="data:image/png;base64,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" alt></p> <h4 id="auth-login-api를-호출하여-vscode에서-디버깅-정보를-확인합니다"><a href="#auth-login-api를-호출하여-vscode에서-디버깅-정보를-확인합니다" aria-hidden="true" class="header-anchor">#</a> auth/login API를 호출하여 VSCode에서 디버깅 정보를 확인합니다.</h4> <p><img src="/assets/img/step13-08.999df694.png" alt></p> <p><img src="/assets/img/step13-06.1cb3329b.png" alt></p></div> <div class="page-edit"><div class="edit-link"><a href="https://github.com/cookpi/blog/edit/master/docs/frameworks/serverless/tutorial-serverless-express-aurora/README.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">3/20/2019, 9:12:15 AM</span></div></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/frameworks/serverless/rest-api/" class="prev">
          REST API
        </a></span> <span class="next"><a href="/frameworks/firebase/">
          Overview
        </a>
        →
      </span></p></div> <div id="disqus_thread" class="content" style="padding-top:0px;"></div></div> <!----></div></div>
    <script src="/assets/js/app.bdc570e9.js" defer></script><script src="/assets/js/2.e34b6f30.js" defer></script><script src="/assets/js/3.e459d297.js" defer></script>
  </body>
</html>
